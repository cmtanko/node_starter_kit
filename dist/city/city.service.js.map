{"version":3,"sources":["../../src/city/city.service.js"],"names":["getCityList","getCity","deleteCity","addCity","details","id","userObj","fetchById","related","fetch","error","fetchAll","where","del","then","city","cityId","get","update","insert"],"mappings":";;;;;QAkBgBA,W,GAAAA,W;QAGAC,O,GAAAA,O;QAiBAC,U,GAAAA,U;QAOAC,O,GAAAA,O;;AA7ChB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,eAAeC,OAAf,CAAuBC,EAAvB,EAA2B;AACzB,MAAI;AACF,QAAIC,UAAU,MAAM,eAAKC,SAAL,CAAeF,EAAf,CAApB;;AAEA,UAAMC,QAAQE,OAAR,CAAgB,SAAhB,EAA2BC,KAA3B,EAAN;;AAEA,WAAOH,OAAP;AACD,GAND,CAME,OAAOI,KAAP,EAAc;AACd,WAAOA,KAAP;AACD;AACF;;AAEM,SAASV,WAAT,GAAuB;AAC5B,SAAO,eAAKW,QAAL,EAAP;AACD;AACM,SAASV,OAAT,CAAiBI,EAAjB,EAAqB;AAC1B,SAAO,eAAKE,SAAL,CAAeF,EAAf,CAAP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACD;;AAEM,SAASH,UAAT,CAAoBG,EAApB,EAAwB;AAC7B,SAAO,kBAAG,MAAH,EACJO,KADI,CACE,SADF,EACaP,EADb,EAEJQ,GAFI,GAGJC,IAHI,EAAP;AAID;;AAEM,SAASX,OAAT,CAAiBY,IAAjB,EAAuB;AAC5B,MAAIC,SAAS,iBAAEC,GAAF,CAAMF,IAAN,EAAY,SAAZ,CAAb;AACA,MAAIC,MAAJ,EAAY;AACV,WAAO,kBAAG,MAAH,EACJE,MADI,CACGH,IADH,EACS,SADT,EAEJH,KAFI,CAEE,SAFF,EAEaI,MAFb,EAGJF,IAHI,EAAP;AAID,GALD,MAKO;AACL,WAAO,kBAAG,MAAH,EACJK,MADI,CACGJ,IADH,EACS,SADT,EAEJD,IAFI,EAAP;AAGD;AACF;;kBAEc;AACbd,0BADa;AAEbC,kBAFa;AAGbC,wBAHa;AAIbC,kBAJa;AAKbC;AALa,C","file":"city.service.js","sourcesContent":["import db from '../db';\nimport Treeize from 'treeize';\nimport _ from 'lodash';\nimport City from '../models/city';\nimport Boom from 'boom';\n\nasync function details(id) {\n  try {\n    let userObj = await City.fetchById(id);\n\n    await userObj.related('country').fetch();\n\n    return userObj;\n  } catch (error) {\n    return error;\n  }\n}\n\nexport function getCityList() {\n  return City.fetchAll();\n}\nexport function getCity(id) {\n  return City.fetchById(id);\n  // return db('city as c')\n  //   .join('country as ry', 'ry.country_id', 'c.country_id')\n  //   .where('c.city_id', id)\n  //   .select('c.city as cities:city', 'ry.country')\n  //   .orderBy('c.city')\n  //   .then(function(rows) {\n  //     let tree = new Treeize();\n  //     tree.grow(rows);\n  //     let cities = tree.getData();\n\n  //     return cities;\n  //   })\n  //   .then();\n}\n\nexport function deleteCity(id) {\n  return db('city')\n    .where('city_id', id)\n    .del()\n    .then();\n}\n\nexport function addCity(city) {\n  let cityId = _.get(city, 'city_id');\n  if (cityId) {\n    return db('city')\n      .update(city, 'city_id')\n      .where('city_id', cityId)\n      .then();\n  } else {\n    return db('city')\n      .insert(city, 'city_id')\n      .then();\n  }\n}\n\nexport default {\n  getCityList,\n  getCity,\n  deleteCity,\n  addCity,\n  details,\n};\n"]}